<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piyaylakay ‚Äî Accueil</title>
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family:"Poppins",sans-serif;}
body {
  background:#e6f0ff;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding-top:30px;
}
.container {
  width:90%;
  max-width:500px;
  background: rgba(255,255,255,0.95);
  padding:30px;
  border-radius:12px;
  box-shadow:0 0 25px #007BFF;
  text-align:center;
  border:1px solid #007BFF;
}
h1,h2,h3 {color:#007BFF; margin-bottom:15px;}
button {width:100%; padding:12px; border:none; border-radius:6px; background:#FFB347; color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; margin-top:10px;}
button:hover {background:#E6953D;}
.produit {border:1px solid #007BFF; border-radius:10px; padding:10px; margin:10px 0;}
.produit img {width:100%; border-radius:10px; margin-bottom:10px;}
.footer {font-size:12px; color:#555; margin-top:15px;}
</style>
</head>
<body>
<div class="container">
  <h1>Piyaylakay</h1>
  <h2>Nos Produits</h2>

  <button onclick="window.location.href='komandpiyay.html'">üõí Voir les commandes</button>

  <!-- Bouton Gestion Produits (visible seulement pour creator/employee) -->
  <div id="adminButtonContainer"></div>

  <div id="listeProduits"></div>
  <p class="footer">¬© 2025 Piyaylakay ‚Äî Technologie avanc√©e</p>
</div>

<script>
// R√©cup√©rer utilisateur connect√©
const user = JSON.parse(localStorage.getItem("dpstore_user") || "null");
if(!user){
  alert("‚ö†Ô∏è Aucun utilisateur connect√© !");
  window.location.href = "index.html";
}

// R√©cup√©rer produits depuis localStorage
let produits = JSON.parse(localStorage.getItem("produits") || "[]");

// Afficher les produits
function afficherProduits(){
  const div = document.getElementById("listeProduits");
  div.innerHTML = "";
  if(produits.length === 0){
    div.innerHTML = "<p>Aucun produit disponible pour le moment.</p>";
    return;
  }
  produits.forEach((p,index)=>{
    const produitDiv = document.createElement("div");
    produitDiv.className = "produit";
    produitDiv.innerHTML = `<img src="${p.image}" alt="${p.nom}">
                            <h3>${p.nom}</h3>
                            <p>Prix : ${p.prix} $</p>
                            <button onclick="commanderProduit(${index})">Commander üõí</button>`;
    div.appendChild(produitDiv);
  });
}

// Ajouter un produit aux commandes (avec email utilisateur)
function commanderProduit(index){
  const produit = produits[index];
  let commandes = JSON.parse(localStorage.getItem("commandes") || "[]");
  const date = new Date().toLocaleString();

  // Ajouter email de l'utilisateur pour filtrage
  commandes.push({
    email: user.email,
    produit: produit.nom,
    prix: produit.prix,
    date: date
  });

  localStorage.setItem("commandes", JSON.stringify(commandes));
  alert(`‚úÖ Produit "${produit.nom}" ajout√© aux commandes !`);
}

// Affichage du bouton gestion produits uniquement pour creator/employee
(function afficherAdminButton() {
  if (user && (user.role === "creator" || user.role === "employee")) {
    const btn = document.createElement("button");
    btn.innerText = "üõ† G√©rer Produits";
    btn.onclick = () => window.location.href = "gespiyaylakay.html";
    document.getElementById("adminButtonContainer").appendChild(btn);
  }
})();

// Initialiser l'affichage
afficherProduits();
</script>
</body>
</html>