<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DPSTORE | PUBG MOBILE</title>

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #0b0f1c;
    margin: 0;
    padding: 0;
    color: #fff;
  }

  /* HEADER */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(8px);
    position: sticky;
    top: 0;
    z-index: 20;
    border-bottom: 1px solid #00ffae25;
  }

  .back-btn {
    background: none;
    border: 2px solid #00ffb3;
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    color: #00ffb3;
    font-weight: bold;
  }

  .logo {
    display: flex;
    align-items: center;
    color: #00ffb3;
    font-weight: 700;
    font-size: 1.4rem;
    letter-spacing: 2px;
  }

  .right-box {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .balance {
    padding: 6px 12px;
    background: rgba(0,255,179,0.1);
    border: 1px solid #00ffb3;
    border-radius: 10px;
    font-weight: bold;
  }

  .cart-btn {
    cursor: pointer;
    font-size: 1.4rem;
  }

  /* PRODUITS */
  .product-box {
    background: #111726;
    margin: 15px;
    padding: 18px;
    border-radius: 14px;
    box-shadow: 0 0 12px rgba(0,255,179,0.08);
  }
  .product-header {
    display: flex;
    align-items: center;
  }
  .product-img {
    width: 75px;
    border-radius: 8px;
  }
  .product-info {
    margin-left: 12px;
    flex: 1;
  }
  .product-name {
    font-size: 1.2rem;
    font-weight: bold;
  }
  .status-tag {
    display: inline-block;
    background: #00ff80;
    color: #000;
    padding: 3px 10px;
    border-radius: 10px;
    font-size: 0.8rem;
    font-weight: bold;
    margin-top: 6px;
  }
  .category-tag {
    display: inline-block;
    background: #50545b;
    color: #fff;
    padding: 3px 10px;
    border-radius: 10px;
    font-size: 0.8rem;
    margin-left: 6px;
  }
  .price {
    margin-top: 6px;
    color: #00ffb3;
    font-size: 1.1rem;
    font-weight: bold;
  }

  .add-btn {
    width: 100%;
    margin-top: 14px;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    background: #00ffb3;
    color: #000;
    cursor: pointer;
  }

  /* POPUP FORMULAIRE */
  #popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    justify-content: center;
    align-items: center;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(4px);
    z-index: 9999;
  }
  .popup-content {
    width: 90%;
    max-width: 380px;
    background: #111726;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 0 18px #00ffb344;
  }

  .form-input {
    width: 100%;
    margin-top: 12px;
    padding: 10px;
    background: #0e1320;
    border-radius: 8px;
    border: 1px solid #00ffb320;
    color: white;
    font-size: 1rem;
  }

  .submit-btn {
    width: 100%;
    margin-top: 16px;
    padding: 12px;
    background: #00ffb3;
    color: #000;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
  }

  .close-btn {
    margin-top: 10px;
    width: 100%;
    padding: 10px;
    background: #ff3b3b;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
  }
</style>
</head>

<body>

<header>
  <button class="back-btn" onclick="window.location.href='produits.html'">‚Üê Retour</button>

  <div class="logo">DP-PUBG</div>

  <div class="right-box">
    <div class="balance" id="balanceBox">0 G</div>
    <div class="cart-btn" onclick="gotoCart()">üõí(<span id="cartCount">0</span>)</div>
  </div>
</header>

<h2 style="margin-left:15px;color:#00ffb3;font-size:1.6rem;">PUBG MOBILE UC</h2>

<div id="product-list"></div>

<!-- POPUP -->
<div id="popup">
  <div class="popup-content">
    <h3 id="popupTitle" style="margin:0 0 10px 0;color:#00ffb3;"></h3>

    <input id="popupName" class="form-input" placeholder="Nom du compte">
    <input id="popupUID" class="form-input" placeholder="UID du compte">

    <button class="submit-btn" onclick="validateForm()">CONFIRMER</button>
    <button class="close-btn" onclick="closePopup()">Annuler</button>
  </div>
</div>

<script>
/* ===================================================
   üî• USER CONNECT√â + PANIER PAR EMAIL
=================================================== */
let user = JSON.parse(localStorage.getItem("dpstore_user") || "{}");

if(!user.email){
  alert("Aucun compte d√©tect√© !");
  window.location.href = "index.html";
}

if(user.balance === undefined) user.balance = 0;

function normalizeId(str){
  return (str||"guest").toLowerCase().replace(/[^a-z0-9@.-]/g,"_").replace(/@/g,"_at_");
}

function getCartKey(){ return "cart_" + normalizeId(user.email); }

function loadCart(){ return JSON.parse(localStorage.getItem(getCartKey())||"[]"); }

function saveCart(cart){ localStorage.setItem(getCartKey(), JSON.stringify(cart)); }

function updateBalanceUI(){
  document.getElementById("balanceBox").textContent = user.balance + " G";
  updateCartCount();
}

function updateCartCount(){
  document.getElementById("cartCount").textContent = loadCart().length;
}

function gotoCart(){ window.location.href = "cart.html"; }

/* ===================================================
   üî• PRODUITS (+20%)
=================================================== */
const products = [
  { uc: "60 UC",  price: 180, img: "https://i.imgur.com/jeQF1aN.jpeg" },
  { uc: "120 UC", price: 350, img: "https://i.imgur.com/jeQF1aN.jpeg" },
  { uc: "325 UC", price: 850, img: "https://i.imgur.com/jeQF1aN.jpeg" },
  { uc: "660 UC", price: 1650, img: "https://i.imgur.com/jeQF1aN.jpeg" },
  { uc: "1800 UC", price: 3500, img: "https://i.imgur.com/jeQF1aN.jpeg" }
];
products.forEach(p => p.price = Math.round(p.price * 1.20));

/* ===================================================
   üî• POPUP FORMULAIRE
=================================================== */
let selectedProduct = null;

function openForm(product) {
  selectedProduct = product;
  document.getElementById("popupTitle").textContent = `${product.uc} - ${product.price} HTG`;
  document.getElementById("popup").style.display = "flex";
}

function closePopup() {
  document.getElementById("popup").style.display = "none";
}

function validateForm() {
  let name = document.getElementById("popupName").value.trim();
  let uid  = document.getElementById("popupUID").value.trim();

  if (!name || !uid) {
    alert("‚ö† Merci de remplir le nom du compte et UID.");
    return;
  }

  let cart = loadCart();
  cart.push({
    uc: selectedProduct.uc,
    price: selectedProduct.price,
    name,
    uid
  });

  saveCart(cart);
  updateCartCount();
  closePopup();
  alert("‚úî Produit ajout√© au panier !");
}

/* ===================================================
   üî• AFFICHAGE PRODUITS
=================================================== */
const list = document.getElementById("product-list");

products.forEach((p) => {
  list.innerHTML += `
    <div class="product-box">
      <div class="product-header">
        <img src="${p.img}" class="product-img">
        <div class="product-info">
          <div class="product-name">${p.uc}</div>
          <span class="status-tag">Disponible</span>
          <span class="category-tag">PUBG MOBILE</span>
          <div class="price">${p.price} HTG</div>
        </div>
      </div>

      <button class="add-btn" onclick='openForm(${JSON.stringify(p)})'>
        AJOUTER AU PANIER
      </button>
    </div>
  `;
});

updateBalanceUI();
</script>

</body>
</html>