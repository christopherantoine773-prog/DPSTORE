<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>DPSTORE ‚Äî Tous les DP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    background:black;
    color:white;
    font-family:Arial;
    padding:20px;
}

h1{
    text-align:center;
    color:#00eaff;
    margin-bottom:20px;
}

.dpItem{
    background:#1a1a1a;
    padding:12px;
    border-radius:10px;
    margin-bottom:12px;
    border-left:4px solid #00eaff;
}

.dpItem p{
    margin:3px 0;
}

.role{
    padding:3px 8px;
    border-radius:6px;
    font-weight:bold;
}

.role.user{ background:#555; }
.role.employee{ background:#ffbb00; color:black; }
.role.creator{ background:#00ff88; color:black; }
.role.admin{ background:#ff4444; color:white; }

button{
    background:#00eaff;
    color:black;
    font-weight:bold;
    padding:10px;
    border:none;
    width:95%;
    margin:10px auto;
    display:block;
    border-radius:10px;
    cursor:pointer;
    font-size:16px;
}

.modifyBtn{
    background:#ff4444 !important;
    color:white !important;
    margin-top:8px;
}

.searchBox{
    width:95%;
    margin:auto;
    margin-bottom:20px;
}

input{
    width:95%;
    padding:10px;
    border-radius:10px;
    border:none;
    margin-top:10px;
    font-size:16px;
}
</style>
</head>
<body>

<h1>üìã Liste compl√®te des DP</h1>

<div class="searchBox">
    <input id="searchInput" placeholder="Rechercher un email, un DP ou un nom..." onkeyup="filterDP()">
</div>

<div id="dpList"></div>

<button onclick="location.href='creator-space.html'">‚¨ÖÔ∏è Retour</button>

<script>
/* ============================================================
   üîç R√©cup√©rer tous les comptes
============================================================ */
function getAllAccounts(){
    return JSON.parse(localStorage.getItem("dpstore_accounts")) || [];
}

/* ============================================================
   üîß G√©n√©rer un DP unique
============================================================ */
function generateUniqueDP(){
    return "DP" + Math.floor(100000 + Math.random() * 900000);
}

/* V√©rifie si un DP est d√©j√† utilis√© */
function isDPUsed(dp, email){
    let accounts = getAllAccounts();
    return accounts.some(acc => acc.dp === dp && acc.email !== email);
}

/* Forcer un DP unique */
function fixDuplicateDP(email){
    let accounts = getAllAccounts();
    let user = accounts.find(a => a.email === email);

    if(!user) return;

    let newDP;
    do {
        newDP = generateUniqueDP();
    } while(isDPUsed(newDP, email));

    user.dp = newDP;

    localStorage.setItem("dpstore_accounts", JSON.stringify(accounts));
    loadDP();
    alert("Le DP a √©t√© modifi√© avec succ√®s !");
}

/* ============================================================
   üìå Affichage des DP
============================================================ */
function loadDP(){
    let list = getAllAccounts();

    // Trier alphab√©tiquement
    list.sort((a,b) => (a.email || "").localeCompare(b.email || ""));

    const container = document.getElementById("dpList");
    container.innerHTML = "";

    if(list.length === 0){
        container.innerHTML = "<p>Aucun compte trouv√©.</p>";
        return;
    }

    list.forEach(u => {

        let duplicated = isDPUsed(u.dp, u.email);

        container.innerHTML += `
            <div class="dpItem">
                <p><b>Nom :</b> ${u.username || "Non d√©fini"}</p>
                <p><b>Email :</b> ${u.email}</p>
                <p><b>DP :</b> <span style="color:${duplicated ? "red" : "#00eaff"};">${u.dp}</span></p>
                ${duplicated ? `<button class="modifyBtn" onclick="fixDuplicateDP('${u.email}')">Corriger DP en doublon</button>` : ""}
                <p><b>Solde :</b> <span style="color:yellow;">${u.balance || 0} cr√©dits</span></p>
                <p><b>R√¥le :</b> 
                    <span class="role ${u.role || 'user'}">${u.role || "user"}</span>
                </p>
                <p><b>Cr√©√© le :</b> ${u.createdAt || "Non enregistr√©"}</p>
            </div>
        `;
    });
}

/* ============================================================
   üîé Recherche
============================================================ */
function filterDP(){
    let input = document.getElementById("searchInput").value.toLowerCase();
    let items = document.querySelectorAll(".dpItem");

    items.forEach(div => {
        let text = div.innerText.toLowerCase();
        div.style.display = text.includes(input) ? "block" : "none";
    });
}

loadDP();
</script>

</body>
</html>
