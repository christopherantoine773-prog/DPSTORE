<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DPSTORE | Google Play & Efootball</title>

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #0b0f19;
    margin: 0;
    padding: 0;
    color: white;
  }

  /* HEADER */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: #111827;
    position: sticky;
    top: 0;
    z-index: 20;
    border-bottom: 2px solid #00eaff;
    box-shadow: 0 0 10px #00eaff;
  }

  .back-btn {
    background: none;
    border: 2px solid #00eaff;
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    color: #00eaff;
  }

  .logo svg {
    width: 55px;
    height: 55px;
  }

  .right-box {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .balance {
    padding: 6px 12px;
    background: #00eaff;
    color: #000;
    border-radius: 8px;
    font-weight: bold;
  }

  .cart-btn {
    cursor: pointer;
    font-size: 1.4rem;
  }

  /* PRODUCT CARD */
  .product-card {
    background: #111827;
    margin: 15px;
    padding: 15px;
    border-radius: 14px;
    border: 1px solid #00eaff33;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 0 12px #00eaff22;
  }

  .product-img {
    width: 70px;
    border-radius: 10px;
    border: 2px solid #00eaff;
    box-shadow: 0 0 10px #00eaff66;
  }

  .btn-add {
    margin-left: auto;
    background: #00eaff;
    color: #000;
    padding: 10px 15px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 0 10px #00eaff;
  }

  .tag {
    display: inline-block;
    background: #00c853;
    color: white;
    padding: 4px 10px;
    border-radius: 10px;
    font-size: 0.8rem;
    margin-top: 6px;
  }

  .tag2 {
    background: #9e9e9e;
  }

  /* ===== MODAL FORM ===== */
  .modal-bg {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.75);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  .modal-box {
    background: #0b132b;
    border: 2px solid #00eaff;
    width: 90%;
    max-width: 420px;
    padding: 25px;
    border-radius: 12px;
    color: white;
    box-shadow: 0 0 25px #00eaff;
    animation: zoom 0.3s ease;
  }

  @keyframes zoom {
    from { transform: scale(0.7); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .modal-box h2 {
    text-align: center;
    font-size: 24px;
    color: #00eaff;
    margin-bottom: 15px;
  }

  .modal-box input,
  .modal-box select {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid #00eaff;
    background: #111827;
    color: white;
  }

  .modal-box button {
    width: 100%;
    padding: 12px;
    margin-top: 18px;
    background: #00eaff;
    border: none;
    color: black;
    font-weight: bold;
    border-radius: 8px;
    font-size: 17px;
    cursor: pointer;
  }

  .close-btn {
    background: red !important;
    color: white !important;
  }
</style>
</head>

<body>

<!-- HEADER -->
<header>
  <button class="back-btn" onclick="window.location.href='produits.html'">‚Üê Retour</button>

  <div class="logo">
    <svg viewBox="0 0 220 220" style="filter: drop-shadow(0 0 8px #00eaff);">
      <rect x="15" y="25" width="190" height="170" rx="20"
            stroke="#00eaff" stroke-width="6" fill="none"/>
      <line x1="15" y1="110" x2="205" y2="110"
            stroke="#00eaff" stroke-width="4"/>
      <circle cx="110" cy="110" r="28"
              stroke="#00eaff" stroke-width="4" fill="none"/>
      <circle cx="110" cy="110" r="4" fill="#00eaff"/>
      <text x="110" y="150"
            font-size="95" font-weight="900"
            fill="#00eaff"
            text-anchor="middle"
            font-family="Poppins, Arial">E</text>
    </svg>
  </div>

  <div class="right-box">
    <div class="balance" id="balanceBox">0 G</div>
    <div class="cart-btn" onclick="window.location.href='cart.html'">üõí(<span id="cartCount">0</span>)</div>
  </div>
</header>

<h2 style="margin-left: 15px;">GOOGLE PLAY & EFOOTBALL</h2>

<div id="product-list"></div>

<!-- ===================== MODAL FORM ========================== -->
<div class="modal-bg" id="orderModal">
  <div class="modal-box">
    <h2>Informations obligatoires</h2>

    <input type="text" id="typeTel" placeholder="Type de t√©l√©phone (PS5, PS4, Mobile)">
    <input type="email" id="email" placeholder="Votre Email">
    <input type="password" id="password" placeholder="Mot de passe">

    <select id="country">
      <option value="+509">üá≠üáπ Ha√Øti (+509)</option>
      <option value="+1">üá∫üá∏ USA (+1)</option>
      <option value="+33">üá´üá∑ France (+33)</option>
      <option value="+229">üáßüáØ B√©nin (+229)</option>
      <option value="+221">üá∏üá≥ S√©n√©gal (+221)</option>
      <option value="+225">üá®üáÆ C√¥te d'Ivoire (+225)</option>
    </select>

    <input type="text" id="whatsapp" placeholder="Num√©ro Whatsapp">

    <button onclick="validateForm()">Valider la commande</button>
    <button class="close-btn" onclick="closeModal()">Annuler</button>
  </div>
</div>

<script>
/* ======================================================
      üî• SYNCHRONISATION SOLDE + PANIER PAR COMPTE
   ====================================================== */
function loadUser() {
  let u = JSON.parse(localStorage.getItem("dpstore_user") || "{}");
  if(u.balance === undefined) u.balance = 0;
  const accounts = JSON.parse(localStorage.getItem("dpstore_accounts") || "[]");
  const acc = accounts.find(a => (a.email || "").toLowerCase() === (u.email || "").toLowerCase());
  if(acc){
    u.balance = acc.balance ?? u.balance;
    localStorage.setItem("dpstore_user", JSON.stringify(u));
  }
  return u;
}

let user = loadUser();
if(!user.email){
  alert("Aucun compte connect√© !");
  window.location.href = "index.html";
}

function normalizeId(str){ return (str||"guest").toLowerCase().replace(/[^a-z0-9@.-]/g,"_").replace(/@/g,"_at_"); }
function getCartKey(){ return "cart_"+normalizeId(user.email); }
function loadCart(){ return JSON.parse(localStorage.getItem(getCartKey())||"[]"); }
function saveCart(arr){ localStorage.setItem(getCartKey(), JSON.stringify(arr)); }

function updateBalanceUI(){
  user = loadUser();
  document.getElementById("balanceBox").textContent = (user.balance||0)+" G";
  updateCartCount();
}

/* ======================================================
      üõí PANIER
   ====================================================== */
function updateCartCount(){
  const cart = loadCart();
  document.getElementById("cartCount").textContent = cart.length;
}
updateBalanceUI();

/* ======================================================
      üéÅ PRODUITS
   ====================================================== */
const imgURL = "https://i.imgur.com/8l7pO4J.jpeg";
const products = [
  { name: "550 PI√àCES", price: 770, img: imgURL },
  { name: "750 PI√àCES", price: 1045, img: imgURL },
  { name: "1040 PI√àCES", price: 1420, img: imgURL },
  { name: "2130 PI√àCES", price: 2880, img: imgURL },
  { name: "3250 PI√àCES", price: 4320, img: imgURL },
  { name: "5700 PI√àCES", price: 7050, img: imgURL },
  { name: "12800 PI√àCES", price: 15070, img: imgURL }
];
products.forEach(p=>p.price=Math.round(p.price*1.20));

/* ======================================================
      üî• AFFICHAGE PRODUITS
   ====================================================== */
const container = document.getElementById("product-list");
let selectedProduct = null;

products.forEach(p=>{
  container.innerHTML += `
    <div class="product-card">
      <img src="${p.img}" class="product-img">
      <div>
        <div style="font-weight:bold;font-size:1.1rem;">${p.name}</div>
        <span class="tag">Disponible</span>
        <span class="tag tag2">Efootball</span>
        <div style="font-size:1.1rem;margin-top:6px;">${p.price} HTG</div>
      </div>
      <button class="btn-add" onclick="openForm('${p.name}', ${p.price})">Ajouter</button>
    </div>
  `;
});

/* ======================================================
      üî• FORMULAIRE MODAL
   ====================================================== */
function openForm(name, price){ selectedProduct={name,price}; document.getElementById("orderModal").style.display="flex"; }
function closeModal(){ document.getElementById("orderModal").style.display="none"; }
document.getElementById("country").addEventListener("change", function(){ document.getElementById("whatsapp").value=this.value+" "; });

function validateForm(){
  const typeTel=document.getElementById("typeTel").value.trim();
  const email=document.getElementById("email").value.trim();
  const pwd=document.getElementById("password").value.trim();
  const whatsapp=document.getElementById("whatsapp").value.trim();

  if(!typeTel||!email||!pwd||!whatsapp){ alert("Veuillez remplir tous les champs obligatoires."); return; }

  let cart = loadCart();
  cart.push({...selectedProduct, typeTel, email, pwd, whatsapp});
  saveCart(cart);
  updateBalanceUI();
  closeModal();
  window.location.href="cart.html";
}

setInterval(updateBalanceUI,1500);
</script>

</body>
</html>